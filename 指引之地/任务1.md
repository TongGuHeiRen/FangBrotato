# 基础主场景开发步骤

## 项目目录结构

在开始之前，建议创建以下目录结构以保持项目组织清晰：

```
机甲肉鸽/
├── 场景/           # 存放所有场景文件
├── 脚本/           # 存放所有脚本文件
├── 资源/           # 存放图像、音频等资源
│   ├── 图像/
│   ├── 音频/
│   └── 字体/
├── 脚本/管理器/     # 存放游戏管理器脚本
└── 单例/           # 存放单例脚本
```

## 1. 创建 主场景.tscn 场景

   `[ ]` 创建新场景，保存为 `主场景.tscn`。
   `[ ]` 添加 `Node` 作为根节点，命名为 `主场景`。
   `[ ]` 添加 `CanvasLayer` 子节点作为背景层，命名为 `背景层`。
   `[ ]` 在 `背景层` 中添加 `TextureRect` 子节点作为背景，命名为 `背景`。
   `[ ]` 添加 `Camera2D` 子节点作为相机，命名为 `相机`，设置为当前相机。
   `[ ]` 添加 `TileMapLayer` 子节点作为地图，命名为 `地图`。
   `[ ]` 添加 `CanvasLayer` 子节点作为 UI 层，命名为 `UI层`。
   `[ ]` 在 `UI层` 中添加 `Label` 子节点作为金币标签，命名为 `金币标签`。
   `[ ]` 在 `UI层` 中添加 `Label` 子节点作为生命值标签，命名为 `生命值标签`。
   `[ ]` 在 `UI层` 中添加 `Label` 子节点作为波次标签，命名为 `波次标签`。
   `[ ]` 在 `UI层` 中添加 `Button` 子节点作为菜单按钮，命名为 `菜单按钮`，设置文本为"菜单"。

## 2. 创建 Player.tscn 用于玩家角色

   `[ ]` 创建新场景，保存在"场景"文件夹下，保存为 `玩家.tscn`。
   `[ ]` 添加 `CharacterBody2D` 作为根节点，命名为 `玩家`。
   `[ ]` 添加 `Sprite2D` 子节点用于显示玩家图像，命名为 `玩家图像`。
   `[ ]` 添加 `CollisionShape2D` 子节点用于碰撞检测，命名为 `碰撞形状`。
   `[ ]` 添加 `Area2D` 子节点用于攻击检测，命名为 `攻击区域`。
   `[ ]` 在 `攻击区域` 中添加 `CollisionShape2D` 子节点定义攻击区域。
   `[ ]` 创建新脚本 `玩家.gd` (继承 `CharacterBody2D`) 并附加到根节点 `玩家`
       `[ ]` 添加 `@onready` 变量引用子节点：`玩家图像`, `碰撞形状`, `攻击区域`。
       `[ ]` 实现 `移动(方向)` 函数：
           根据传入的 `方向` 移动玩家。
       `[ ]` 实现 `攻击()` 函数：
           执行玩家攻击逻辑。
       `[ ]` 实现 `受到伤害(伤害值)` 函数：
           减少玩家生命值，检查是否死亡。

## 3. 创建游戏管理器脚本

   `[ ]` 在"脚本/管理器"文件夹下创建 `游戏管理器.gd` 脚本（不附加到场景）。
   `[ ]` 实现游戏状态管理：
       - 金币、生命值、当前波次等变量
       - 游戏状态更新方法
   `[ ]` 实现敌人生成管理：
       - 敌人生成计时器
       - 敌人生成方法
   `[ ]` 实现波次系统管理：
       - 波次计时器
       - 波次更新方法

## 4. 编写 主场景.gd 脚本

   `[ ]` 创建新脚本，保存为 `主场景.gd`。
   `[ ]` 添加类名定义和继承关系。
   `[ ]` 预加载 `玩家` 场景（可同时预加载 `脚本/管理器/游戏管理器.gd` 为“游戏管理器脚本”）。
   `[ ]` 定义 `onready` 变量引用子节点（地图、相机、金币标签、生命值标签、波次标签等）。
   `[ ]` 添加游戏管理器实例：
       - `var 游戏管理器 = 游戏管理器脚本.new()`
   `[ ]` 实现 `初始化场景()` 方法：
       - 初始化地图
       - 生成玩家
       - 初始化游戏状态
   `[ ]` 实现 `更新金币显示()` 方法，更新金币标签文本。
   `[ ]` 实现 `更新生命值显示()` 方法，更新生命值标签文本。
   `[ ]` 实现 `更新波次显示()` 方法，更新波次标签文本。
   `[ ]` 实现 `_process()` 方法，处理基本游戏逻辑。
   `[ ]` 实现 `_ready()` 方法：
       - 连接信号（按钮点击等）
       - 调用初始化场景方法
       - 更新UI显示

## 5. 创建敌人系统

   `[ ]` 创建 `敌人.tscn` 场景，表示敌人。
   `[ ]` 添加 `CharacterBody2D` 作为根节点，命名为 `敌人`。
   `[ ]` 添加 `Sprite2D` 子节点用于显示敌人图像，命名为 `敌人图像`。
   `[ ]` 添加 `CollisionShape2D` 子节点用于碰撞检测，命名为 `碰撞形状`。
   `[ ]` 创建新脚本 `敌人.gd` (继承 `CharacterBody2D`) 并附加到根节点 `敌人`
       `[ ]` 添加 `@onready` 变量引用子节点：`敌人图像`, `碰撞形状`。
       `[ ]` 实现 `移动(目标位置)` 函数：
           向目标位置移动敌人。
       `[ ]` 实现 `受到伤害(伤害值)` 函数：
           减少敌人生命值，检查是否死亡。
       `[ ]` 实现 `死亡()` 函数：
           处理敌人死亡逻辑（掉落金币等）。

## 6. 实现游戏流程

   `[ ]` 在 `GameManager.gd` 中添加敌人生成逻辑：
       - 添加 `Timer` 节点作为敌人生成定时器
       - 连接 `timeout` 信号到敌人生成方法
       - 实现 `生成敌人()` 方法创建敌人实例
   `[ ]` 实现波次系统：
       - 添加 `Timer` 节点作为波次定时器
       - 连接 `timeout` 信号到波次更新方法
       - 实现 `开始新波次()` 方法增加波次难度
   `[ ]` 实现游戏结束逻辑：
       - 检查玩家生命值是否为0
       - 显示游戏结束界面
       - 提供重新开始选项

## 7. 添加菜单系统

   `[ ]` 创建 `菜单场景.tscn` 场景，表示游戏菜单。
   `[ ]` 添加 `Control` 作为根节点，命名为 `菜单场景`。
   `[ ]` 设置 `process_mode = PROCESS_MODE_ALWAYS` 以确保菜单在游戏暂停时仍可响应输入。
   `[ ]` 添加 `Panel` 子节点作为背景，命名为 `背景面板`。
   `[ ]` 添加 `VBoxContainer` 子节点作为按钮容器，命名为 `按钮容器`。
   `[ ]` 在 `按钮容器` 中添加 `Button` 子节点作为继续按钮，命名为 `继续按钮`，设置文本为"继续"。
   `[ ]` 在 `按钮容器` 中添加 `Button` 子节点作为重新开始按钮，命名为 `重新开始按钮`，设置文本为"重新开始"。
   `[ ]` 在 `按钮容器` 中添加 `Button` 子节点作为退出按钮，命名为 `退出按钮`，设置文本为"退出"。
   `[ ]` 创建新脚本 `菜单场景.gd` (继承 `Control`) 并附加到根节点 `菜单场景`
       `[ ]` 添加 `@onready` 变量引用子节点：`继续按钮`, `重新开始按钮`, `退出按钮`。
       `[ ]` 实现按钮点击事件处理函数。

## 8. 集成到游戏流程

   `[ ]` 在 `主场景.gd` 中添加打开菜单的功能。
   `[ ]` 在 `主场景.gd` 的 `_process()` 方法中添加菜单输入检测：
       - 检测菜单按钮按下
       - 暂停游戏并打开菜单
   `[ ]` 实现菜单选项功能：
       - 继续游戏：关闭菜单，恢复游戏
       - 重新开始：重置游戏状态
       - 退出：返回主菜单
   `[ ]` 测试完整流程：从主场景进入游戏，打开菜单，选择不同选项。

## 注意事项

1. **Godot 4.x 兼容性**：
   - 使用 `CharacterBody2D` 替代已移除的 `KinematicBody2D`
   - 使用 `TileMapLayer` 替代旧版 `TileMap`（如适用）

2. **节点命名规范**：
   - 所有节点类型名称使用正确的大小写形式（如 `CharacterBody2D` 而非 `characterBody2D`）
   - 保持节点命名一致性，便于代码引用

3. **计时器实现**：
   - 使用 `Timer` 节点替代 `_process()` 中的手动计时
   - 通过信号机制驱动生成流程，提高稳定性

4. **UI 层结构**：
   - 菜单场景设置 `process_mode = PROCESS_MODE_ALWAYS` 确保暂停时仍可响应
   - 简化 UI 层级结构，提高性能

5. **代码组织**：
   - 将游戏逻辑拆分到独立的管理器脚本
   - 避免主场景脚本过于臃肿，提高可维护性

   